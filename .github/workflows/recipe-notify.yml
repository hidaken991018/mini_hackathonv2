name: Recipe Notification (Daily)

on:
  schedule:
    # 07:00 JST = 22:00 UTC (previous day)
    - cron: "0 22 * * *"
  workflow_dispatch:

jobs:
  trigger:
    runs-on: ubuntu-latest
    steps:
      - name: Call recipe batch notification API
        env:
          NOTIFY_SECRET: ${{ secrets.NOTIFY_SECRET }}
          BASE_URL: ${{ secrets.NOTIFY_BASE_URL }}
        run: |
          if [ -z "$NOTIFY_SECRET" ] || [ -z "$BASE_URL" ]; then
            echo "Missing secrets: NOTIFY_SECRET / NOTIFY_BASE_URL"
            exit 1
          fi
          curl -sS -X POST "$BASE_URL/api/recipe/batch-notify" \
            -H "Content-Type: application/json" \
            -H "x-notify-secret: $NOTIFY_SECRET" \
            --max-time 600
